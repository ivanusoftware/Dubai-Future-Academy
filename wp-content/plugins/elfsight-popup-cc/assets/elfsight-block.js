/*
    Popup
    Version: 1.1.0
    Release date: Wed Sep 02 2020

    https://elfsight.com

    Copyright (c) 2020 Elfsight, LLC. ALL RIGHTS RESERVED
*/

!function(wp,$){"use strict";let IconBlock=function(e){return wp.element.createElement("svg",{width:"20",height:"20",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",class:"dashicon"},[wp.element.createElement("path",{d:"M12.436 1.154c.7 0 1.051.258 1.051.774 0 .517-.35.775-1.051.775H4.55c-.58 0-1.051.462-1.051 1.033v13.682c0 .57.47 1.033 1.051 1.033h10.513c.58 0 1.051-.462 1.051-1.033v-11.1c0-.69.263-1.033.789-1.033.525 0 .788.344.788 1.032v11.618c0 1.14-.941 2.065-2.102 2.065H4.026c-1.162 0-2.103-.925-2.103-2.065V3.219c0-1.14.941-2.065 2.103-2.065h8.41zm1.38 13.461c.654 0 1.184.517 1.184 1.154 0 .637-.53 1.154-1.184 1.154H6.184C5.53 16.923 5 16.406 5 15.77c0-.637.53-1.154 1.184-1.154h7.632zm.658-2.307c.29 0 .526.258.526.577 0 .318-.236.577-.526.577H5.526c-.29 0-.526-.259-.526-.577 0-.319.236-.577.526-.577h8.948zm0-1.923c.29 0 .526.258.526.577 0 .318-.236.576-.526.576H5.526c-.29 0-.526-.258-.526-.576 0-.32.236-.577.526-.577h8.948zm-2.87-6.833a.526.526 0 0 1 .14.14L15 8.461H5l3.271-3.53a.527.527 0 0 1 .815.051l.467.652 1.32-1.943a.527.527 0 0 1 .732-.14zm-5.642.294a.962.962 0 1 1 0 1.923.962.962 0 0 1 0-1.923zM18.552.113l.181.181c.15.15.15.394 0 .545l-.892.892.892.892c.15.15.15.394 0 .544l-.181.182a.385.385 0 0 1-.545 0l-.892-.892-.892.892a.385.385 0 0 1-.544 0l-.182-.182a.385.385 0 0 1 0-.544l.892-.892-.892-.892a.385.385 0 0 1 0-.545l.182-.181c.15-.15.394-.15.544 0l.892.892.892-.892c.15-.15.395-.15.545 0z",id:"a"})])};if(void 0===wp.components||void 0===wp.blocks||void 0===wp.element||void 0===wp.i18n)return!1;const{Component:Component}=window.React,{__:__}=wp.i18n,el=wp.element.createElement,registerBlockType=wp.blocks.registerBlockType,ServerSideRender=wp.components.ServerSideRender,restApiUrl=window.wpApiSettings.root+"/elfsight-popup/admin",restApiNonce=window.wpApiSettings.nonce;let initTimeout;function initWidget(){clearTimeout(initTimeout),initTimeout=setTimeout(function(){const widgets=document.querySelectorAll("[data-elfsight-popup-options]");Array.prototype.slice.call(widgets).forEach(function(widget){const options=widget.getAttribute("data-elfsight-popup-options"),data=JSON.parse(decodeURIComponent(options));eval("eappsPopup(widget, data)"),widget.removeAttribute("data-elfsight-popup-options"),widget.removeAttribute("data-elfsight-popup-version"),widget.closest(".elfsight-block-widget-container").classList.add("elfsight-block-widget-initialized")})},1500)}async function getWidgets(){const e=await $.ajax({type:"GET",url:restApiUrl+"/widgets/list/",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",restApiNonce)}});return e.status?[e.data,e.data.reduce(function(e,t){return e[t.id]=t,e},{})]:[]}function getWidgetId(e){let t;return e.some(function(e){return"1"===e.active&&(t=parseInt(e.id),!0)}),t}class Widget extends Component{componentDidMount(){initWidget()}componentDidUpdate(){initWidget()}render(){const{id:e}=this.props;return e?el("div",{className:"elfsight-block-widget-container"},el(ServerSideRender,{block:"elfsight-popup/block",attributes:{id:e}}),el("div",{className:"elfsight-block-widget-placeholder"},el(IconBlock,{}),el("span",{},"Popup"))):null}}class Button extends Component{render(){const{href:e,className:t,text:i}=this.props,o=document.location.origin+document.location.pathname.replace("post.php","admin.php")+"?page=elfsight-popup#";return el("a",{href:o+e,target:"_blank",className:t},i)}}class WidgetSelect extends Component{constructor(){super(),this.state={widgets:[]}}setWidget(e){e.preventDefault();const{setAttributes:t}=this.props,i=e.target.querySelector("option:checked");t({id:parseInt(i.value)})}componentDidMount(){const{id:e,setAttributes:t}=this.props;getWidgets().then(i=>{const[o,s]=i;this.setState({widgets:o});const n=!(!s[e]||"1"!==s[e].active);t(!n&&s?{id:getWidgetId(o),exist:!0}:{id:e,exist:n})})}render(){const{widgets:e}=this.state,{id:t}=this.props;return e.length>0?el("div",{className:"components-base-control"},el("div",{className:"components-base-control__field"},el("select",{className:"components-select-control__input",id:"elfsight-popup-block-control-id",value:t,onChange:this.setWidget.bind(this)},e.map(({id:e,name:t})=>el("option",{value:e},t))))):null}}registerBlockType("elfsight-popup/block",{title:"Popup",description:"Create various types of popups for your website for more leads and higher sales.",icon:{src:IconBlock},category:"widgets",keywords:["Popup","Elfsight"],supports:{html:!1},attributes:{id:{type:"number"},exist:{type:"bool",default:!1}},edit:function(e){const{attributes:{id:t,exist:i},setAttributes:o}=e;return getWidgets().then(e=>{const[s,n]=e;o(!i&&s?{id:getWidgetId(s),exist:!0}:{id:t,exist:i})}),el(wp.element.Fragment,{},el(wp.editor.InspectorControls,{},el(wp.components.PanelBody,{className:"elfsight-block-panel",title:"Select widget"},el(WidgetSelect,{id:t,setAttributes:function(t){e.setAttributes(t)}}),i?el("div",{className:"elfsight-block-panel-group"},el(Button,{href:"/edit-widget/"+t,className:"components-button is-button is-default is-large elfsight-block-panel-button",text:__("Edit Widget")}),el(Button,{href:"/add-widget/",className:"elfsight-block-panel-link",text:__("Create new widget")})):el("div",{className:"elfsight-block-panel-group"},el("span",{},__("No widgets yet")),el(Button,{href:"/add-widget/",className:"components-button is-button is-default is-primary is-large elfsight-block-panel-button",text:__("Create Widget")})))),i?el(Widget,{id:t,exist:i}):null,i?null:el("div",{className:"elfsight-block-form"},el("div",{className:"elfsight-block-form-header"},el(IconBlock,{}),el("span",{},"Popup")),el("div",{className:"elfsight-block-form-text"},__("Create various types of popups for your website for more leads and higher sales."),el("br"),el("strong",{},__("Let's create your first widget!"))),el(Button,{href:"/add-widget/",className:"components-button is-button is-default is-primary is-large elfsight-block-form-button",text:__("Create Widget")})))},save:function(){return null}})}(wp,jQuery);